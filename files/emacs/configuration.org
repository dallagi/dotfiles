* Package management
Setup melpa.

#+begin_src emacs-lisp
  (require 'package)
  (add-to-list 'package-archives '("melpa" . "https://melpa.org/packages/") t)
  (package-initialize)
#+end_src

* Editor
** Evil
Setup evil and evil-collections.

#+begin_src emacs-lisp
   (use-package evil
    :ensure t
    :init
    (setq evil-want-keybinding nil) ;; Expected by evil-collection
    (setq evil-want-integration t) ;; Expected by evil-collection
    (setq evil-want-C-u-scroll t) ;; Keep vim behavior for C-u
    (setq evil-undo-system 'undo-redo) ;; Simple undo/redo
    :config
    (evil-mode 1))

  (use-package evil-collection
    :after evil
    :ensure t
    :diminish (evil-collection-unimpaired-mode . "")
    :config
    (evil-collection-init)) 
#+end_src

** Keybinds
#+begin_src emacs-lisp
  (use-package which-key
    :ensure t
    :init (which-key-mode)
    :diminish ""
    :config
    (setq which-key-idle-delay 1))

  (use-package general
    :ensure t
    :config
    (general-override-mode) ;; allow overriding key definitions
    (general-create-definer my-leader-def :prefix "SPC")
    (my-leader-def
      :states '(motion normal visual)
      :keymaps 'override

      ":" '(execute-extended-command :which-key "M-x")
      ))
#+end_src

** Snippets
#+begin_src emacs-lisp
  (use-package yasnippet
    :ensure t
    :hook ((lsp-mode . yas-minor-mode))
    :config (yas-global-mode 1))

  (use-package yasnippet-snippets :ensure t)
#+end_src


* Git
#+begin_src emacs-lisp
  ;; follow symlinks, instead of opening the symlink directly
  (setq vc-follow-symlinks t)

  (use-package magit
    :ensure t
    :init
    ;; display magit status buffer in full screen
    (setq magit-display-buffer-function #'magit-display-buffer-fullframe-status-v1)

    :general
    (my-leader-def
      :states '(motion normal visual)
      :keymaps 'override

      "g" '(:ignore t :which-key "Git")
      "gg" '(magit-status :which-key "Magit status")
      ))
#+end_src
* Config files management
Keep backups, autosaves, etc. in their own directory, in order not to clutter emacs config directory.org

#+begin_src emacs-lisp
  (use-package no-littering
    :ensure t
    :init
    ;; no-littering doesn't set this by default so we must place
    ;; auto save files in the same path as it uses for sessions
    (setq auto-save-file-name-transforms
	  `((".*" ,(no-littering-expand-var-file-name "auto-save/") t)))
    )
#+end_src
* Appearance
** Basic UX

#+begin_src emacs-lisp
  ;; Use y-n instead of yes-no
  (setq use-short-answers t)

  ;; Setup visible bell and disable sound bell
  (setq visible-bell t)

  ;; don't show warning buffer when native-comp warnings are logged
  (setq native-comp-async-report-warnings-errors 'silent)

  ;; Enable recursive minibuffers
  ;; Useful when something needs to open a minibuffer within the minibuffer
  (setq enable-recursive-minibuffers t)
#+end_src

** Keep minimal UI elements

#+begin_src emacs-lisp
  (setq inhibit-startup-message t) ; Disable emacs welcome screen
  (scroll-bar-mode -1)             ; Disable visible scrollbar
  (tool-bar-mode -1)               ; Disable the toolbar
  (tooltip-mode -1)                ; Disable tooltips
  (menu-bar-mode -1)               ; Disable the menu bar
#+end_src

** Theme
#+begin_src emacs-lisp
  (setq custom-safe-themes t)   ; Treat all themes as safe

  (use-package color-theme-sanityinc-tomorrow
      :ensure t
      :config
      (color-theme-sanityinc-tomorrow-night))
#+end_src

** Font
#+begin_src emacs-lisp
  ;; Font
  (set-face-attribute 'default nil
                       :font "Fira Code Retina"
                       :weight 'regular
                       :height 120)

  (set-face-attribute 'fixed-pitch nil
                    :font "Fira Code Retina"
                    :weight 'regular
                    :height 120)

  (set-face-attribute 'variable-pitch nil
                    :font "Fira Sans"
                    :weight 'regular
                    :height 120)
#+end_src

** Line numbers
#+begin_src emacs-lisp
  (global-display-line-numbers-mode t)

  ;; Disable line numbers for some modes
  (dolist (mode '(term-mode-hook
		  shell-mode-hook
		  eshell-mode-hook))
    (add-hook mode (lambda () (display-line-numbers-mode 0))))
#+end_src

** Vertical selection
#+begin_src emacs-lisp
  (use-package vertico
    :ensure t
    :bind (:map vertico-map
		("C-j" . vertico-next)
		("C-k" . vertico-previous))
    :custom
    (vertico-cycle t) ;; cycle among results - go back to beginning once bottom is reached
    :init
    (vertico-mode))

  (use-package orderless
    :ensure t
    :after vertico
    :init
    (setq completion-styles '(orderless basic)
	  completion-category-defaults nil
	  ;; allow opening multiple files via wildcard
	  completion-category-overrides '((file (styles partial-completion)))))

  (use-package marginalia
    :ensure t
    :after vertico
    :init
    (marginalia-mode))
#+end_src

** Modeline
#+begin_src emacs-lisp
  ;; Diminish minor modes
  (use-package diminish
    :ensure t
    :config
    (diminish 'auto-revert-mode))

  ;; Show column number
  (column-number-mode) 
#+end_src

* Files and projects
** Projects

#+begin_src emacs-lisp
  (use-package projectile
    :ensure t

    :init
    (projectile-mode +1)
    (setq
     projectile-project-search-path '(("~/Workspace" . 2))
     projectile-auto-discover t)

    :config
    ;; (define-key projectile-mode-map (kbd "SPC p") 'projectile-command-map)

    :general
    (my-leader-def
      :states '(motion normal visual)
      :keymaps 'override

      "SPC" '(projectile-find-file :which-key "Find file in project")

      "p" '(:ignore t :which-key "Project")
      "pa" '(projectile-add-known-project :which-key "Add known project")
      "pi" '(projectile-invalidate-cache :which-key "Invalidate cache")
      "pp" '(projectile-switch-project :which-key "Switch project")
      "px" '(:keymap projectile-command-map :whick-key "Projectile commands")
      ))

  (use-package rg :ensure t)
#+end_src

* Languages
** Org
#+begin_src emacs-lisp
  (use-package evil-org
    :ensure t
    :after org
    :diminish ""
    :hook (org-mode . (lambda () (evil-org-mode)))
    :config
    (require 'evil-org-agenda)
    (evil-org-agenda-set-keys))
#+end_src
